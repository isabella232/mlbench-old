{% extends 'main/base.html' %}

{% block content %}
<div class="row">
    <div class="col-3">Name <button type="button" class="btn btn-outline-danger" id="delete-button"><span data-feather="x"></span></button>: </div>
    <div class="col-9">{{ run.name }}</div>
</div>
<div class="row">
    <div class="col-3">Created: </div>
    <div class="col-9">{{ run.created_at }}</div>
</div>
<div class="row">
    <div class="col-3">State: </div>
    <div class="col-9" id="run-state">{{ run.state }}</div>
</div>
<div class="row">
    <div class="col-3">Command: </div>
    <div class="col-9">{{ run.job_metadata.command }}</div>
</div>
<div class="row">
    <div class="col-3">Master-Worker: </div>
    <div class="col-9">{{ run.job_metadata.master_name }}</div>
</div>
<div class="row">
    <div class="col-3">Workers </div>
    <div class="col-9">{{ run.job_metadata.pods }}</div>
</div>
<div class="row">
    <div class="col-3">Stdout: </div>
    <div class="col-9" id="run-stdout"><pre>{{ run.job_metadata.stdout }}</pre></div>
</div>
<div class="row">
    <div class="col-3">Stderr: </div>
    <div class="col-9" id="run-stderr"><pre>{{ run.job_metadata.stderr }}</pre></div>
</div>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
    $(document).ready(function(){
        $("#delete-button").click(function(){
            $.ajax({
                url: "/api/runs/{{ run.id }}/",
                type: 'DELETE',
                success: function(){
                    window.location.replace("/runs");
                }
            });
        });

        var updateRunData = function(){
            $.getJSON("/api/runs/{{ run.id }}/",
                function(data){
                    $("#run-state").text(data['state']);
                    $("#run-stdout").text(data['job_metadata']["stdout"].join("\n"));
                    $("#run-stderr").text(data['job_metadata']["stderr"].join("\n"));
                    setTimeout(updateRunData, 1000)
                });
        };

        updateRunData();
    });
</script>
{% endblock %}